(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/contact/contact"],{"263c":function(t,e,a){"use strict";(function(t){a("ff24");n(a("66fd"));var e=n(a("9da7"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"4b2a":function(t,e,a){"use strict";a.r(e);var n=a("e0d9"),o=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=o.a},"70c4":function(t,e,a){"use strict";var n,o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){!t.disableToDetailEvent&&("user"===t.info.mode?t.toFriendDetailEvent(0):t.toCrowdDetailEvent())},t.e1=function(e){t.item.sendId!==t.myInformation.id&&t.toFriendDetailEvent(t.item)})},i=[];a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}))},"9da7":function(t,e,a){"use strict";a.r(e);var n=a("70c4"),o=a("4b2a");for(var i in o)"default"!==i&&function(t){a.d(e,t,(function(){return o[t]}))}(i);a("e854");var s,r=a("f0c5"),c=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=c.exports},b96b:function(t,e,a){},e0d9:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(a("4795")),o=i(a("eb47"));function i(t){return t&&t.__esModule?t:{default:t}}function s(t,e,a,n,o,i,s){try{var r=t[i](s),c=r.value}catch(d){return void a(d)}r.done?e(c):Promise.resolve(c).then(n,o)}function r(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var i=t.apply(e,a);function r(t){s(i,n,o,r,c,"next",t)}function c(t){s(i,n,o,r,c,"throw",t)}r(void 0)}))}}var c={data:function(){return{myInformation:getApp().globalData.myInformation,info:{data:{},mode:""},messageList:[],inputData:"",disableToDetailEvent:!1}},onLoad:function(){var e=this;t.$on("toContact",(function(a){e.info=a,t.$off("toContact")})),t.$emit("fromContact"),t.$on("reloadContact",(function(){e.initData()}))},onHide:function(){"user"===this.info.mode?this.$socket.removeListener("globalMessage"):this.$socket.removeListener("globalCrowdMessage")},onUnload:function(){"user"===this.info.mode?this.$socket.removeListener("globalMessage"):this.$socket.removeListener("globalCrowdMessage"),t.$off("reloadContact")},onShow:function(){var t=this;"user"===this.info.mode?(this.chageMessageStatus(0),this.$socket.on("globalMessage",(function(e){(e.sendId==t.info.data.id&&e.receiveId==t.myInformation.id||e.sendId==t.myInformation.id&&e.receiveId==t.info.data.id)&&(t.initData(),t.chageMessageStatus(0))}))):(this.changeCrowdMessageStatus(),this.$socket.on("globalCrowdMessage",(function(e){-1!==e.members.indexOf(t.myInformation.id)&&e.crowdId===t.info.data.id&&(t.initData(),t.changeCrowdMessageStatus())})))},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return r(n.default.mark((function a(){var i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.request({method:"POST",url:e.$baseURL+"".concat("user"===e.info.mode?"getMessage":"getCrowdMessage"),data:JSON.stringify({id:e.info.data.id}),header:{"Content-Type":"application/json;charset=utf-8",Authorization:"".concat(t.getStorageSync("token"))}});case 2:i=a.sent[1].data,200===i.status?(e.messageList=i.data.reverse(),e.messageList.forEach((function(t){t.createdAt=(0,o.default)(new Date(t.createdAt))}))):t.showToast({title:"获取消息异常，请重试",icon:"none"});case 4:case"end":return a.stop()}}),a)})))()},toCrowdDetailEvent:function(){var e=this;this.disableToDetailEvent=!0,t.$on("fromCrowdDetail",(function(){t.$emit("toCrowdDetail",{id:e.info.data.id}),t.$off("fromCrowdDetail")})),t.navigateTo({url:"../crowdDetail/crowdDetail",complete:function(){e.disableToDetailEvent=!1}})},toFriendDetailEvent:function(e){var a=this;this.disableToDetailEvent=!0,0===e?t.navigateTo({url:"/pages/friendDetail/friendDetail?avatar=".concat(this.info.data.avatar,"&username=").concat(this.info.data.username,"&nickname=").concat(this.info.data.nickname,"&signature=").concat(this.info.data.signature,"&updatedAt=").concat(this.info.data.updatedAt,"&createdAt=").concat(this.info.data.createdAt,"&id=").concat(this.info.data.id,"&phone=").concat(this.info.data.phone,"&birthday=").concat(this.info.data.birthday,"&gender=").concat(this.info.data.gender,"&email=").concat(this.info.data.email),complete:function(){a.disableToDetailEvent=!1}}):t.navigateTo({url:"/pages/friendDetail/friendDetail?avatar=".concat(e.avatar,"&username=").concat(e.username,"&nickname=").concat(e.nickname,"&signature=").concat(e.signature,"&updatedAt=").concat(e.updatedAt,"&createdAt=").concat(e.createdAt,"&id=").concat(e.sendId,"&phone=").concat(e.phone,"&birthday=").concat(e.birthday,"&gender=").concat(e.gender,"&email=").concat(e.email),complete:function(){a.disableToDetailEvent=!1}})},backEvent:function(){t.navigateBack({delta:1})},insertMessageEvent:function(){var e=this;return r(n.default.mark((function a(){var o,i;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(o=e.inputData,e.inputData="",""===o){a.next=7;break}return a.next=5,t.request({method:"POST",url:e.$baseURL+"".concat("user"===e.info.mode?"insertMessage":"insertCrowdMessage"),data:JSON.stringify("user"===e.info.mode?{message:o,receiveUsername:e.info.data.username}:{message:o,receiveCrowdId:e.info.data.id}),header:{"Content-Type":"application/json;charset=utf-8",Authorization:"".concat(t.getStorageSync("token"))}});case 5:i=a.sent[1].data,200===i.status?"user"===e.info.mode?(e.$socket.emit("message",{sendId:e.myInformation.id,receiveId:e.info.data.id}),e.$socket.emit("messageBox",[e.myInformation.id,e.info.data.id])):(e.$socket.emit("crowdMessage",{members:i.data,crowdId:e.info.data.id}),e.$socket.emit("messageBox",i.data)):t.showToast({title:"插入消息异常，请重试",icon:"none"});case 7:case"end":return a.stop()}}),a)})))()},chageMessageStatus:function(e){var a=this;return r(n.default.mark((function o(){var i;return n.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.request({method:"POST",url:a.$baseURL+"changeMessageStatus",data:JSON.stringify({id:a.info.data.id,mode:e}),header:{"Content-Type":"application/json;charset=utf-8",Authorization:"".concat(t.getStorageSync("token"))}});case 2:i=n.sent[1].data,200===i.status||t.showToast({title:"改变消息状态异常，请重试",icon:"none"});case 4:case"end":return n.stop()}}),o)})))()},changeCrowdMessageStatus:function(){var e=this;return r(n.default.mark((function a(){var o;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.request({method:"POST",url:e.$baseURL+"changeCrowdMessageStatus",data:JSON.stringify({crowdId:e.info.data.id,userId:e.myInformation.id}),header:{"Content-Type":"application/json;charset=utf-8",Authorization:"".concat(t.getStorageSync("token"))}});case 2:o=a.sent[1].data,200===o.status||t.showToast({title:"改变消息状态异常，请重试",icon:"none"});case 4:case"end":return a.stop()}}),a)})))()}}};e.default=c}).call(this,a("543d")["default"])},e854:function(t,e,a){"use strict";var n=a("b96b"),o=a.n(n);o.a}},[["263c","common/runtime","common/vendor"]]]);